-- Create the SKU_ATTRIBUTE table
CREATE TABLE SKU_ATTRIBUTE (
                               SKU_ATTRIBUTE_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
                               GROUP_ID NUMBER,
                               SKU_ID NUMBER NOT NULL,
                               ATTRIBUTE_ID NUMBER NOT NULL,
                               ATTRIBUTE_VALUE VARCHAR2(450) NOT NULL,
                               CONSTRAINT FK_SKU_ATTRIBUTE_SKUS FOREIGN KEY (SKU_ID) REFERENCES SKU(SKU_ID),
                               CONSTRAINT FK_SKU_ATTRIBUTE_ATTRIBUTES FOREIGN KEY (ATTRIBUTE_ID) REFERENCES ATTRIBUTE(ATTRIBUTE_ID)
);

-- Create sequence for GROUP_ID
CREATE SEQUENCE group_id_seq START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;

-- Create trigger to auto-generate GROUP_ID
CREATE OR REPLACE TRIGGER trg_group_id_before_insert
BEFORE INSERT ON SKU_ATTRIBUTE
FOR EACH ROW
BEGIN
   IF :NEW.GROUP_ID IS NULL THEN
      :NEW.GROUP_ID := group_id_seq.NEXTVAL;
END IF;
END;
/
